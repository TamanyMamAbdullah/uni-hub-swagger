openapi: 3.0.3
info:
  title: Uni Hub API
  version: 1.0.0
  description: Modular OpenAPI spec for Uni Hub
servers:
  - url: https://api.unihub.example.com/api/v1
    description: Production
  - url: http://localhost:3000/api/v1
    description: Local Development
paths:
  /auth/register:
    post:
      tags:
        - Authentication
      summary: Register a new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
            example:
              email: student@example.com
              password: StrongPassword123
              firstName: John
              lastName: Doe
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              example:
                success: true
                data:
                  user:
                    id: uuid-123
                    email: student@example.com
                    firstName: John
                    lastName: Doe
                    isVerified: false
                meta: {}
                timestamp: '2025-01-20T12:00:00Z'
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /auth/login:
    post:
      tags:
        - Authentication
      summary: Login user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            example:
              email: student@example.com
              password: StrongPassword123
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
              example:
                success: true
                data:
                  accessToken: jwt-access-token
                  refreshToken: jwt-refresh-token
                  user:
                    id: uuid-123
                    email: student@example.com
                    firstName: John
                    lastName: Doe
                meta: {}
                timestamp: '2025-01-20T12:00:00Z'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /auth/refresh:
    post:
      tags:
        - Authentication
      summary: Refresh the access token
      responses:
        '200':
          description: New access token created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenRefreshResponse'
              example:
                success: true
                data:
                  accessToken: new-jwt-access-token
                meta: {}
                timestamp: '2025-01-20T12:00:00Z'
        '401':
          description: Refresh token expired or invalid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /auth/logout:
    post:
      tags:
        - Authentication
      summary: Logout user
      responses:
        '200':
          description: Logged out successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              example:
                success: true
                data:
                  message: Logged out successfully
                meta: {}
                timestamp: '2025-01-20T12:00:00Z'
  /auth/verify-email:
    post:
      tags:
        - Authentication
      summary: Verify user email
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VerifyEmailRequest'
            example:
              token: verification-token
      responses:
        '200':
          description: Email verified
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Invalid token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /auth/forgot-password:
    post:
      tags:
        - Authentication
      summary: Request password reset email
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ForgotPasswordRequest'
            example:
              email: student@example.com
      responses:
        '200':
          description: Email sent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
  /auth/reset-password:
    post:
      tags:
        - Authentication
      summary: Reset password using a token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResetPasswordRequest'
            example:
              token: reset-token
              newPassword: NewStrongPassword123
      responses:
        '200':
          description: Password reset successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Invalid token or password
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    UUID:
      type: string
      format: uuid
      example: a3f47b18-12d4-4b33-99ef-e0f3c4da08cc
    Timestamp:
      type: string
      format: date-time
      example: '2025-01-20T12:00:00Z'
    Meta:
      type: object
      properties:
        page:
          type: integer
          example: 1
        limit:
          type: integer
          example: 20
        total:
          type: integer
          example: 123
        hasMore:
          type: boolean
          example: true
    Pagination:
      type: object
      properties:
        cursor:
          type: string
          nullable: true
          example: eyJpZCI6IjEyMyJ9
        limit:
          type: integer
          example: 20
        nextCursor:
          type: string
          nullable: true
          example: eyJpZCI6IjQ1NiJ9
    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
        meta:
          $ref: '#/components/schemas/Meta'
        timestamp:
          $ref: '#/components/schemas/Timestamp'
    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        code:
          type: string
          example: INVALID_INPUT
        message:
          type: string
          example: Email format is invalid.
        details:
          type: array
          items:
            type: string
        timestamp:
          $ref: '#/components/schemas/Timestamp'
    UserSummary:
      type: object
      description: Minimal public-facing user fields
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        email:
          type: string
          format: email
        firstName:
          type: string
        lastName:
          type: string
        avatarUrl:
          type: string
          nullable: true
          example: https://cdn.unihub.com/avatars/u123.png
        isVerified:
          type: boolean
          example: false
    UserProfile:
      type: object
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        email:
          type: string
        firstName:
          type: string
        lastName:
          type: string
        bio:
          type: string
          nullable: true
        avatarUrl:
          type: string
          nullable: true
        coverPhotoUrl:
          type: string
          nullable: true
        major:
          type: string
          nullable: true
        graduationYear:
          type: integer
          nullable: true
        location:
          type: string
          nullable: true
        timezone:
          type: string
          nullable: true
        reputationScore:
          type: integer
          example: 120
        createdAt:
          $ref: '#/components/schemas/Timestamp'
        updatedAt:
          $ref: '#/components/schemas/Timestamp'
    MediaItem:
      type: object
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        url:
          type: string
        type:
          type: string
          enum:
            - image
            - video
            - file
    Reaction:
      type: object
      properties:
        userId:
          $ref: '#/components/schemas/UUID'
        type:
          type: string
          enum:
            - like
            - love
            - laugh
            - sad
            - angry
    CommentSummary:
      type: object
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        author:
          $ref: '#/components/schemas/UserSummary'
        content:
          type: string
        createdAt:
          $ref: '#/components/schemas/Timestamp'
    Notification:
      type: object
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        type:
          type: string
        content:
          type: string
        isRead:
          type: boolean
        createdAt:
          $ref: '#/components/schemas/Timestamp'
    EventSummary:
      type: object
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        title:
          type: string
        location:
          type: string
        startTime:
          $ref: '#/components/schemas/Timestamp'
    ListingSummary:
      type: object
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        title:
          type: string
        price:
          type: number
        thumbnail:
          type: string
    MessageSummary:
      type: object
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        sender:
          $ref: '#/components/schemas/UserSummary'
        content:
          type: string
        createdAt:
          $ref: '#/components/schemas/Timestamp'
    RegisterRequest:
      type: object
      required:
        - email
        - password
        - firstName
        - lastName
      properties:
        email:
          type: string
          format: email
        password:
          type: string
        firstName:
          type: string
        lastName:
          type: string
        universityEmail:
          type: string
          format: email
          nullable: true
    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
        password:
          type: string
    LoginResponse:
      type: object
      properties:
        accessToken:
          type: string
        refreshToken:
          type: string
        user:
          $ref: '#/components/schemas/UserSummary'
    TokenRefreshResponse:
      type: object
      properties:
        accessToken:
          type: string
    VerifyEmailRequest:
      type: object
      required:
        - token
      properties:
        token:
          type: string
    ForgotPasswordRequest:
      type: object
      required:
        - email
      properties:
        email:
          type: string
          format: email
    ResetPasswordRequest:
      type: object
      required:
        - token
        - newPassword
      properties:
        token:
          type: string
        newPassword:
          type: string
security:
  - bearerAuth: []
